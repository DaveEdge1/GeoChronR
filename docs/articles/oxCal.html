<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro to OxCal in geoChronR • geoChronR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Intro to OxCal in geoChronR">
<meta property="og:description" content="geoChronR">
<meta property="og:image" content="https://nickmckay.github.io/geoChronR/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geoChronR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Getting Started With geoChronR</li>
    <li>
      <a href="../articles/Introduction.html">Introduction to geoChronR</a>
    </li>
    <li>
      <a href="../articles/correlation.html">Ensemble Correlation</a>
    </li>
    <li>
      <a href="../articles/regression.html">Ensemble Regression</a>
    </li>
    <li>
      <a href="../articles/spectral_analysis.html">Spectral Analysis</a>
    </li>
    <li>
      <a href="../articles/PCA.html">Ensemble Principal Components Analysis</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Tutorials highlighting additional geoChronR use cases</li>
    <li>
      <a href="../articles/oxCal.html">Introduction to oxCal in geoChronR</a>
    </li>
    <li>
      <a href="../articles/PlotTimeseriesStack.html">Plot a stack of timeseries</a>
    </li>
    <li>
      <a href="../articles/TsFilteringAndMapping.html">Dataset filtering and mapping (with iso2k)</a>
    </li>
    <li>
      <a href="../articles/tidyIso2k.html">Tidy filtering and mapping (with tidyverse &amp; iso2k)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nickmckay/geoChronR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro to OxCal in geoChronR</h1>
                        <h4 class="author">Nick McKay</h4>
            
            <h4 class="date">2020-11-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nickmckay/geoChronR/blob/master/vignettes/oxCal.Rmd"><code>vignettes/oxCal.Rmd</code></a></small>
      <div class="hidden name"><code>oxCal.Rmd</code></div>

    </div>

    
    
<div id="use-oxcal-to-create-an-age-model" class="section level1">
<h1 class="hasAnchor">
<a href="#use-oxcal-to-create-an-age-model" class="anchor"></a>Use oxCal to create an age model</h1>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/nickmckay/geoChronR">geoChronR</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">lipdR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">oxcAAR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
</pre></div>
<div id="setting-up-oxcal" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-oxcal" class="anchor"></a>Setting up oxCal</h2>
<p>The <code>oxcAAR</code> package provides efficient access from R to the oxCal executables, which will need to be set up on your computer before you can use it. Once it’s installed you won’t need to repeat this step, just point to where it’s installed. If it’s already installed, it will tell you.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/oxcAAR/man/quickSetupOxcal.html">quickSetupOxcal</a></span>(path = <span class="st">"~/OxCal"</span>)
<span class="co">#&gt; Oxcal is installed but Oxcal executable path is wrong. Let's have a look...</span>
<span class="co">#&gt; Oxcal path set!</span>
<span class="co">#&gt; NULL</span>
</pre></div>
<p>OK, let’s get a LiPD file from the LinkedEarth Wiki:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
 <span class="kw">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/readLipd.html">readLipd</a></span>(<span class="st">"http://wiki.linked.earth/wiki/index.php/Special:WTLiPD?op=export&amp;lipdid=BJ8-03-70GGC.Linsley.2010"</span>)
<span class="co">#&gt; [1] "reading: Special:WTLiPD?op=export&amp;lipdid=BJ8-03-70GGC.Linsley.2010.lpd"</span>
</pre></div>
<p>Now we can run it through oxcal. First, we specify our oxcal path, then use the <code>runOxcal</code> function. Like the other <code>run{AgeModel}</code> functions in geoChronR, you can leave the parameters empty and specify the choicecs interactively, or you can specify everything for replicability. For choosing the variable names, if you did it interactively and would like to recall those choices, try the <code>getLastVarString</code> function.</p>
<p>Here, in addition to the variable choices, there are a few key parameters to note. First, we specify a “static” reservoir age and uncertainty. You can use this if you want to apply the same deltaR (and uncertainty) to all the ages. Alternatively, these can be columns in the chron measurement tables.</p>
<p>Also, note that we’ve specified the surface age and uncertainty, as that was not included in the measurent table.</p>
<p>Finally, there are two more key parameters, the <code>depth.interval</code> and the <code>events.per.unit.length</code>. These have a substantial impact the output. The <code>depth.interval</code> controls the spacing at which to calculate the age model uncertainty distributions, and the <code>events.per.unit.length</code> is the key parameter for the poisson distribution. As the number events increases, the modeled sequence will become more monitonic (linear) between ages. If you’re having trouble getting OxCal to produce a valid model for your sequence, tinker with these two parameters. Fewer <code>events.per.unit.length</code> and a larger <code>depth.interval</code> will increase the flexibility of the model and likelihood of convergence.</p>
<p>Optionally, you can set <code>events.per.unit.length.uncertainty</code> to a positive number to indicate a prior uncertainty estimate (in orders of magnitude) on <code>events.per.unit.length</code>. This will tell OxCal to treat <code>events.per.unit.length</code> as a variable and optimize it to fit the data. This often returns better results, especially in the absence of an informed prior on <code>events.per.unit.length</code>, but <strong>greatly</strong> increases the run time (expect a run to take multiple hours).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runOxcal.html">runOxcal</a></span>(<span class="kw">L</span>,
              lab.id.var = <span class="st">'id'</span>, 
              age.14c.var = <span class="st">'age14c'</span>, 
              age.14c.uncertainty.var = <span class="st">'age14cuncertainty'</span>, 
              age.var = <span class="st">'calendarage'</span>, 
              age.uncertainty.var = <span class="st">'calendarageuncertainty'</span>, 
              depth.var = <span class="st">'depth'</span>, 
              reservoir.age.14c.var = <span class="kw">NULL</span>, 
              reservoir.age.14c.uncertainty.var = <span class="kw">NULL</span>, 
              rejected.ages.var = <span class="kw">NULL</span>,
              static.reservoir.age = <span class="fl">70</span>,
              static.reservoir.age.unc = <span class="fl">50</span>,
              oxcal.path = <span class="st">"~/OxCal"</span>,
              surface.age = <span class="fl">0</span>,
              surface.age.unc = <span class="fl">25</span>,
              depth.interval = <span class="fl">10</span>,
              events.per.unit.length = <span class="fl">.1</span>)
<span class="co">#&gt; Looking for laboratory ID </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for radiocarbon ages </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for 1-sigma radiocarbon age uncertainty (+/-) </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for calibrated/calendar ages </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for 2-sigma calibrated age uncertainty (+/-) </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for depth or position </span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; Looking for radiocarbon reservoir age offsets (deltaR) </span>
<span class="co">#&gt; radiocarbon reservoir age offsets (deltaR) does not seem to exist, moving on.</span>
<span class="co">#&gt; Looking for radiocarbon reservoir age offsets (deltaR) uncertainties </span>
<span class="co">#&gt; radiocarbon reservoir age offsets (deltaR) uncertainties does not seem to exist, moving on.</span>
<span class="co">#&gt; Looking for rejected ages </span>
<span class="co">#&gt; rejected ages does not seem to exist, moving on.</span>
<span class="co">#&gt; [1] "Variable choices for reuse..."</span>
<span class="co">#&gt; For future reference: here are the options you chose:</span>
<span class="co">#&gt;  Find later with getLastVarString()</span>
<span class="co">#&gt; lab.id.var = 'id', age.14c.var = 'age14c', age.14c.uncertainty.var = 'age14cuncertainty', age.var = 'calendarage', age.uncertainty.var = 'calendarageuncertainty', depth.var = 'depth', reservoir.age.14c.var = NULL, reservoir.age.14c.uncertainty.var = NULL, rejected.ages.var = NULL, </span>
<span class="co">#&gt; Oxcal is now running, depending on your settings and your computer, this may take a few minutes to several hours. The model is complete when a table of model diagnostics appears.</span>
</pre></div>
<p>Great. After OxCal finishes running successfully, it will return this table showing some diagnostics of the MCMC statistics for the dated levels. If the table is empty, that’s a sure sign that there was an error in your run.</p>
<p>Now that the age model has been generated, you can plot your age model with <code>plotChronEns</code>, just like with the other methods.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="../reference/plotChronEns.html">plotChronEns</a></span>(<span class="kw">L</span>)
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; [1] "plotting your chron ensemble. This make take a few seconds..."</span>
</pre></div>
<p><img src="oxCal_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>To map the the age ensembles onto the proxy data, use <code>mapAgeEnsembleToPaleoData</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapAgeEnsembleToPaleoData.html">mapAgeEnsembleToPaleoData</a></span>(<span class="kw">L</span>,age.var = <span class="st">"ageEnsemble"</span>)
<span class="co">#&gt; [1] "BJ8-03-70GGC.Linsley.2010"</span>
<span class="co">#&gt; [1] "Looking for age ensemble...."</span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
<span class="co">#&gt; [1] "getting depth from the paleodata table..."</span>
<span class="co">#&gt; [1] "Found it! Moving on..."</span>
</pre></div>
<p>Finally, let’s select the ageEnsemble and the SST variables…</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">ageEns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectData.html">selectData</a></span>(<span class="kw">L</span>,var.name = <span class="st">"ageEnsemble"</span>)
<span class="kw">SST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectData.html">selectData</a></span>(<span class="kw">L</span>,var.name = <span class="st">"SST"</span>)
</pre></div>
<p>And plot up the output.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="../reference/plotTimeseriesEnsRibbons.html">plotTimeseriesEnsRibbons</a></span>(X = <span class="kw">ageEns</span>, Y = <span class="kw">SST</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/plotTimeseriesEnsLines.html">plotTimeseriesEnsLines</a></span>(X = <span class="kw">ageEns</span>, Y = <span class="kw">SST</span>,n.ens.plot = <span class="fl">10</span>)
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span>
</pre></div>
<p><img src="oxCal_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
<p>It looks reasonable, so we can now proceed to use this ensemble like it’s any other.</p>
<p>Happy modeling!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas McKay, Julien Emile-Geay, Deborah Khider.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '21c1c99b27cf4a45be9f8db70183f6c7',
    indexName: 'lipd-utilities',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
